# IOS 

## Protecciones

Los iPhone no estan diseñados para que se instalen aplicaciones fuera de la Apple store. Existen 2 metodos que se utilizan para este fin. "Sideloading" y el "Jailbreak! En los modelos mas nuevos todo el hardware viene firmado es por eso que aunque cambies un microfono con eso es suficiente para que no funcione mas.

![image](https://github.com/user-attachments/assets/b19bd273-362a-4fa0-8a28-6b4c38a8934e)

## Swift vs Objective C

Objective-C y Swift son lenguajes de programación utilizados para desarrollar aplicaciones para iOS. Swift es un lenguaje más moderno y está en constante evolución con nuevas características y mejoras. En resumen, Swift es el lenguaje recomendado actualmente por Apple para nuevos desarrollos debido a su simplicidad, seguridad y rendimiento mejorado. Si se hace una analogia con Android se podrias decir que Swift es como Kotlin.

## .IPA

Las apps para Iphone tiene esta extencion. Ademas que recuerda que todo esta basado en UNIX.  Las .ipa contienen una carpeta /Payload/ en donde se tiene informacion valiosa:

![image](https://github.com/user-attachments/assets/d879d382-d8d7-4069-94d3-93b6e666b89c)

Info.plist equivale al Android Manifest.xml Asi que es un archivo muy importante.  

## xCode

Es un entorno de desarrollo para IOS entiendo que es el oficial y nos permite hacer Sideloading.

## Sacar una ipa del iPhone

El proceso es un poco similar a Android solo cambian las rutas. Las apps esta en la ruta “/var/containers/Bundle/Application”

<img width="506" alt="image" src="https://github.com/user-attachments/assets/232136ff-00d1-4192-8c07-47059a738e7d">

Ahora el problema es buscar cual id es el de la app que queremos obtener. 

<img width="511" alt="image" src="https://github.com/user-attachments/assets/63bb0aee-6b49-4b4c-9d57-fc9d3f3ecc51">

ls * muestra todos los archivos en las subcarpetas la otra parte del comando es facil...Una vez que tenemos la carpeta set tiene que crear una carpeta **"Payload"** que es en donde se guardaran todos los archivos y es asi como esta formada una IPA cuando se va a instalar basicamente es un .zip con una carpeta Payload y dentro todos los archivos cuando se descomprime pues es diferente como en la imganen de arriba.


<img width="518" alt="image" src="https://github.com/user-attachments/assets/1e9c6076-24f3-4298-a7d1-e58a5509edb5">

Se pasa todo a la carpeta de Payload y despues de crear un archivo zip con extencion .ipa. Por ultimo agregamos el archivo iTunesMetadata.plist. Para mas detalle sigue el manual.

> https://medium.com/@alokkumar0200/how-to-extract-ipa-from-jailbroken-ios-device-c670c8f6d2ec

## Frida

Para usar esta tool me dio muchos problemas conectaba el iphone a la mac y no me queria correr el comando la zsh y lo corria en Windows y se quedaba esperando que conectara el iPhone cuando ya estaba conectado. La solucion fue: Instalar a la antigua el  frida (no de cydia)

![image](https://github.com/user-attachments/assets/d8c4f55a-d487-46fd-9467-5620ebca2f0e)

Pasamos el archivo al iPhone:

```
scp .\frida_16.4.5_iphoneos-arm.deb root@192.168.0.27:/private/var/mobile/
```
Ya dentro del iphone necesitamos instalar el paquete normal

```
dpkg -i frida_16.1.8_iphoneos-arm64.deb
ps aux | grep frida
```
Pero para que funcione apesar de que ya esta conectado no funciona entonces se tiene que modificar la configuracion para que se pueda acceder por la red. Este metodo me parece muy similar al que se sigue en Android.

```
root@iphone # pwd
/private/var/mobile

# You may need to install a text editor
root@iphone# apt-get install nano

root@iphone # cd /var/jb/Library/LaunchDaemons
root@iphone # ls
re.frida.server.plist
# ... more .plist files

root@iphone # nano re.frida.server.plist
```

La conclucion es que ahora te puedes conectar desde cualquier computadora que este en la red sin depender del USB:

```
frida-ps -H IP
```
Algo que creo que descubri es que -U al parecer es para usb entonces lo estuve haciendo mal con android (checar)

### Para sacar nombre de las apps

En este caso sacar el nombre de la IPA:

```
frida-ps -ai -H IP
```

Recuerda que el nombre de las apps aun en IOS empiezan con com. etc

> https://github.com/frida/frida/releases

> https://medium.com/@zahidaz/manually-installing-and-configuring-frida-on-jailbroken-ios-devices-a-step-by-step-guide-e9e2673fdfc9

## Objection 

Para el analisis dinamico necesitamos utilizar objection y volver a firmar la IPA entonces tambien vamos necesitar la apple developer licence y el xCode. Recuerda vas a hacer modificaciones a la app por eso se necesita firmar. Para conectarte con objection por ip usa:

```
 objection --network -h 192.168.0.27 --gadget "com.appsecreta" explore
```
![image](https://github.com/user-attachments/assets/32e306de-7e59-4a50-9670-0be1d74cefb7)

Esto te permite aprovechar el servidor de frida que dejaste escuchando (-l 0.0.0.0).

## Tipos de Jail Break

Jailbreaking is the process of removing restrictions imposed by Apple on iOS devices. It allows users to gain root access to the operating system, enabling them to install third-party apps, tweaks, and themes unavailable on the App Store. Los tipos de jailbreak se pueden clasificar principalmente en tres categorías:

### Tethered Jailbreak:

Este tipo de jailbreak requiere que el dispositivo esté conectado a una computadora cada vez que se reinicia. El dispositivo necesita pasar por el proceso de jailbreak nuevamente para funcionar correctamente después de cada reinicio.

### Semi-tethered Jailbreak

Similar al tethered, pero si el dispositivo se reinicia sin conexión a una computadora, seguirá funcionando con funcionalidad limitada hasta que se realice el proceso de jailbreak nuevamente con la ayuda de una computadora.

### Untethered Jailbreak

Es el tipo más deseado de jailbreak. Una vez aplicado, el dispositivo puede reiniciarse sin la necesidad de estar conectado a una computadora, y el jailbreak permanecerá activo con todas las funciones disponibles sin restricciones.

Cada tipo de jailbreak tiene sus ventajas y desventajas, dependiendo de la facilidad de uso y las necesidades específicas del usuario.

## Leer Info.plist

Este archivo si bien es un xml se encuentra codificado para poder leerlo se necesita parsear

```bash
plistutil -i Info.plist -o out.xml

cat out.xml
```
## Verificar si una Aplicación iOS es Depurable

Primero, necesitas extraer los contenidos del archivo IPA, que es esencialmente un archivo zip. Dentro de la carpeta descomprimida, navega al directorio Payload/someapp.app/, donde someapp.app es el nombre de tu aplicación. Aquí deberías encontrar el archivo Info.plist. Abre el archivo Info.plist con un editor de texto o un visor de plist. Busca las siguientes claves y verifica sus valores. (antes tienes que parsear el archivo Info.plist)

```
plistutil -i Info.plist -o out.xml
cat out.xml | grep -B 5 -A 5 "get-task-allow"
```

get-task-allow: Esta clave en Info.plist controla si la aplicación puede ser depurada. En una aplicación de producción, este valor debe estar configurado como <false/>.

## Capturas de pantalla

Cuando saques una captura de pantalla se va a guarda en:

```
/var/mobile/Media/DCIM/
```

Y ahi estan varias carpetas para descargar usa scp

```
scp root@192.168.3.6:/var/mobile/Media/DCIM/100APPLE/IMG_0002.PNG ./
```


# Bibliografia 

## Frida install 

> https://frida.re/docs/ios/

## IOS pentest example

> https://medium.com/@livelession/ios-mobile-application-i-e-ipa-vulnerability-assessment-and-penetration-testing-walkthrough-4e351484fdb9

## IOS CheetSheet

> https://github.com/ivan-sincek/ios-penetration-testing-cheat-sheet





































